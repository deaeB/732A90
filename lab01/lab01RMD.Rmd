---
title: "lab01"
output: html_document
date: "2022-11-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Question 1

1. Check the results of the snippets. Comment what is going on.

```{r Q1, echo=TRUE}
x1 <- 1/3 ; x2 <- 1/4
if ( x1 - x2 == 1/12) {
  print("Subtraction is correct")
} else {
  print("Subtraction is wrong")
}

# and

x1 <- 1 ; x2 <- 1/2
if ( x1 - x2 == 1/2) {
  print("Subtraction is correct")
} else {
  print("Subtraction is wrong")
}
```

- 1/3 and 1/12 are infinite decimals, while 1/2 is not.  
Computation of floating-point numbers makes the result different.

2. If there are any problems, suggest improvements.
- give a tolerance |a - b| < ε， while ε is close to 0
```{r}
x1 <- 1/3 ; x2 <- 1/4
if ( abs((1 / 12) - (x1 - x2)) < exp(-30)) {
  print("Subtraction is correct")
} else {
  print("Subtraction is wrong")
}
```

or directly using all.equal()
```{r}
x1 <- 1/3 ; x2 <- 1/4
if (all.equal(1 / 12, x1 - x2) ) {
  print("Subtraction is correct")
} else {
  print("Subtraction is wrong")
}
```


## Question 2

1. Write your own R function to calculate the derivative of $f(x) = x$ in this way with $ε = 10^{-15}$
```{r}
Q2_derivative <- function(x){
  
  e <- 10^-15
  fp <-  ((x + e) - x) / e
  
  return(fp)
}

```

2. Evaluate your derivative function at x = 1 and x = 100000.
```{r}
Q2_derivative(1)
Q2_derivative(100000)
```

3. What values did you obtain? What are the true values? Explain the reasons behind the
discovered differences.
- True value should be exactly 1. While what we got is 1.110223 at x = 1 and 0 at x = 100000.  
ε + x - x makes floating-point number rounded. And due to 100000 occupies too much mantissa, the result was rounded to 0.


## Question 3

1. Write your own R function, myvar, to estimate the variance in this way

```{r Q3.1}
myvar <- function(x){
  n <- length(x)
  s2 <- (sum(x^2) - (sum(x))^2 / n) / (n - 1)
  
  return(s2)
}
```

2. Generate a vector x =    $(x_1,..., x_{10000})$ with 10000 random numbers with mean $10^8$ and
variance 1.

```{r Q3.2}
x <- rnorm(10000, mean = 10^8, sd = 1)
```

3. For each subset $X_i = \{x_1,..., x_i, i = 1,...,10000$ compute the difference $Y_i = myvar(X_i)− var(X_i)$, where $var(X_i)$ is the standard variance estimation function in R. Plot the dependence $Y_i$ on $i$. Draw conclusions from this plot. How well does your function work? Can you explain the behaviour?
- Three branches can be seen in the plot: one tends to 0, one tends to -2, and one is concentrated around -1.If the result is correct,all of the result will be equal to 0,so the function doesn't work well.If we look at the calculation results of the myvar function, we will find that many of them are 0. Therefore, the reason may be that two large numbers occupy too many mantissas, so the numbers with smaller digits are rounded, resulting in the subtraction of two large numbers The result is 0.

```{r Q3.3}
Y <- numeric(length = 10000)
for (i in 1:10000) {
  Y[i] <- myvar(x[1:i]) - var(x[1:i])
}

plot(1:10000, Y)
```

4. How can you better implement a variance estimator? Find and implement a formula that will give the same results as var()?
We could implement this formula to calculate the variance:$$Var = \frac{1}{n-1}\sum_{i=1}^n(X_i - \bar{X})^2$$

```{r Q3.4}
myvar_new=function(x){
  x_mean=sum(x)/(length(x))
  sum_x=sum((x-x_mean)^2)
  return(sum_x/(length(x)-1))
}
myvar_new(x)
```


## Question 4

1.












